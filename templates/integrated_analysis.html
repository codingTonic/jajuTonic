<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user_info.name }}ë‹˜ì˜ ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼</title>
    <link rel="stylesheet" href="static/css/analysis_style.css">
</head>
<body>
    <div class="report-container">
        {% if not is_download %}
        <div class="report-controls">
            <a href="/download-html" class="btn btn-secondary">HTML ë‹¤ìš´ë¡œë“œ</a>
            <a href="/" class="btn btn-secondary">ë‹¤ì‹œ ì…ë ¥í•˜ê¸°</a>
        </div>
        {% endif %}

        <h1>{{ user_info.name }}ë‹˜ì˜ ì‚¬ì£¼ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
        
        <h2>ê¸°ë³¸ ì •ë³´</h2>
        <div class="info-box info-grid">
            <div>
                <h3>ê°œì¸ ì •ë³´</h3>
                <strong>ìƒë…„ì›”ì¼:</strong> {{ user_info.birthdate }}<br>
                <strong>íƒœì–´ë‚œ ì‹œê°„:</strong> {{ user_info.birthtime or 'ëª¨ë¦„' }}<br>
                <strong>ì„±ë³„:</strong> {{ 'ë‚¨ì„±' if user_info.gender == 'male' else 'ì—¬ì„±' }}<br>
                <strong>ì—°ì•  ìƒíƒœ:</strong> 
                {% if user_info.relationship == 'single' %}ì†”ë¡œ
                {% elif user_info.relationship == 'dating' %}ì—°ì• ì¤‘
                {% elif user_info.relationship == 'married' %}ê¸°í˜¼
                {% else %}{{ user_info.relationship }}{% endif %}<br>
                {% if user_info.mbti %}
                <strong>MBTI:</strong> {{ user_info.mbti }}<br>
                {% endif %}
            </div>
            {% if saju_result %}
            <div>
                <h3>ì‚¬ì£¼ ì •ë³´</h3>
                <strong>ì—°ì£¼(å¹´æŸ±):</strong> {{ saju_result.year_pillar.heavenly_stem }}{{ saju_result.year_pillar.earthly_branch }}<br>
                <strong>ì›”ì£¼(æœˆæŸ±):</strong> {{ saju_result.month_pillar.heavenly_stem }}{{ saju_result.month_pillar.earthly_branch }}<br>
                <strong>ì¼ì£¼(æ—¥æŸ±):</strong> {{ saju_result.day_pillar.heavenly_stem }}{{ saju_result.day_pillar.earthly_branch }}<br>
                <strong>ì‹œì£¼(æ™‚æŸ±):</strong> {{ saju_result.time_pillar.heavenly_stem }}{{ saju_result.time_pillar.earthly_branch }}<br>
                <strong>ì¼ê°„(æ—¥å¹²):</strong> {{ saju_result.day_master }}<br>
            </div>
            {% endif %}
        </div>
        
        <h2>ë¶„ì„ ëª©ì°¨</h2>
        <div class="toc-box">
            {% for part in analysis_parts %}
            <div class="toc-part-group">
                <span class="toc-item">Part {{ loop.index }}: {{ part.title }}</span>
                {% for section in part.sections %}
                <span class="toc-sub-item">{{ section.title }}</span>
                {% endfor %}
            </div>
            {% endfor %}
        </div>

        {% for part in analysis_parts %}
        <div class="analysis-section">
            <h2>Part {{ loop.index }}: {{ part.title }}</h2>
            {% for section in part.sections %}
            <div class="section-content">
                <h3>{{ section.title }}</h3>
                {% for paragraph in section.content %}
                <div class="content">{{ paragraph.text | format_content | safe }}</div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% if not loop.last %}
        <hr>
        {% endif %}
        {% endfor %}
        
        <!-- ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ê´‘ê³  -->
        <div class="ad-section">
            <h3>ì¿ íŒ¡ì—ì„œ ì•„ë¬´ê±°ë‚˜ êµ¬ë§¤í•˜ê¸°</h3>
            <div class="ad-container" id="ad-container">
                <script src="https://ads-partners.coupang.com/g.js" id="coupang-script"></script>
                <script>
                    try {
                        new PartnersCoupang.G({"id":648436,"trackingCode":"AF9065033","subId":null,"template":"carousel","width":"320","height":"140"});
                    } catch (e) {
                        console.log('ê´‘ê³  ë¡œë“œ ì‹¤íŒ¨:', e);
                    }
                </script>
            </div>
        </div>
    </div>

    <!-- ê´‘ê³ ì°¨ë‹¨ê¸° ê°ì§€ ëª¨ë‹¬ -->
    <div id="adblock-modal" class="adblock-modal">
        <div class="adblock-modal-content">
            <span class="close-modal" onclick="closeAdBlockModal()">&times;</span>
            <h3>ğŸ›¡ï¸ ê´‘ê³ ì°¨ë‹¨ê¸°ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤</h3>
            <p>
                ê´‘ê³ ì°¨ë‹¨ê¸°ë¡œ ì¸í•´ ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ ê´‘ê³ ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ì €í¬ ì„œë¹„ìŠ¤ëŠ” ê´‘ê³  ìˆ˜ìµìœ¼ë¡œ ìš´ì˜ë˜ê³  ìˆì–´ìš”.
            </p>
            <p>
                ê´‘ê³ ë¥¼ í—ˆìš©í•´ì£¼ì‹œë©´ ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                <strong>ê´‘ê³ ì°¨ë‹¨ê¸°ë¥¼ ì ì‹œ í•´ì œí•˜ê±°ë‚˜ ì´ ì‚¬ì´íŠ¸ë¥¼ ì˜ˆì™¸ë¡œ ì¶”ê°€í•´ì£¼ì„¸ìš”.</strong>
            </p>
            <div class="adblock-modal-buttons">
                <button class="adblock-modal-btn primary" onclick="reloadPage()">
                    ìƒˆë¡œê³ ì¹¨í•˜ê¸°
                </button>
                <button class="adblock-modal-btn secondary" onclick="closeAdBlockModal()">
                    ê·¸ëƒ¥ ê³„ì†í•˜ê¸°
                </button>
            </div>
        </div>
    </div>

    <script>
        // ê´‘ê³ ì°¨ë‹¨ê¸° ê°ì§€ ìŠ¤í¬ë¦½íŠ¸
        function detectAdBlocker() {
            // ì¿ íŒ¡ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            const coupangScript = document.getElementById('coupang-script');
            const adContainer = document.getElementById('ad-container');
            
            setTimeout(() => {
                // ê´‘ê³  ì»¨í…Œì´ë„ˆì˜ ë‚´ìš©ì´ ë¹„ì–´ìˆê±°ë‚˜ ìŠ¤í¬ë¦½íŠ¸ê°€ ì°¨ë‹¨ëœ ê²½ìš°
                const hasAd = adContainer.querySelector('iframe') || 
                             adContainer.querySelector('.coupang-widget') ||
                             adContainer.children.length > 2; // script íƒœê·¸ 2ê°œ ì™¸ì— ë‹¤ë¥¸ ìš”ì†Œê°€ ìˆëŠ”ì§€
                
                // ì¿ íŒ¡ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê´‘ê³ ê°€ í‘œì‹œë˜ì§€ ì•Šì€ ê²½ìš°
                if (!hasAd || (typeof PartnersCoupang === 'undefined')) {
                    showAdBlockModal();
                }
            }, 3000); // 3ì´ˆ í›„ í™•ì¸
        }

        function showAdBlockModal() {
            // ì´ë¯¸ ëª¨ë‹¬ì´ í‘œì‹œë˜ì—ˆëŠ”ì§€ í™•ì¸ (ì¤‘ë³µ ë°©ì§€)
            if (sessionStorage.getItem('adblock-modal-shown')) {
                return;
            }
            
            const modal = document.getElementById('adblock-modal');
            if (modal) {
                modal.style.display = 'block';
                sessionStorage.setItem('adblock-modal-shown', 'true');
            }
        }

        function closeAdBlockModal() {
            const modal = document.getElementById('adblock-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function reloadPage() {
            sessionStorage.removeItem('adblock-modal-shown');
            window.location.reload();
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('adblock-modal');
            if (event.target === modal) {
                closeAdBlockModal();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ê´‘ê³ ì°¨ë‹¨ê¸° ê°ì§€ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            detectAdBlocker();
        });
    </script>
</body>
</html> 